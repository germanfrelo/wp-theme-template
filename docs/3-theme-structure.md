# Theme structure

## Overview

Important directories and files of the theme:

```text
/
├── .github/
│   └── workflows/
│       └── deploy.yml
├── assets/
│   ├── fonts/
│   └── js/
│       ├── editor/
│       └── frontend/
├── includes/
├── parts/
├── patterns/
├── src/
│   ├── css/
│   └── svg/
├── templates/
├── .gitignore
├── .rsyncignore
├── composer.json
├── functions.php
├── package.json
├── postcss.config.js
├── style.css
├── svgo.config.js
└── theme.json
```

### `package.json`

This is the project manifest used by `npm` to manage development dependencies and define the scripts used to build and lint the theme (e.g., `npm run start`, `npm run build`).

### `assets/`

The `assets/` directory is for static files that do **not** require any processing and should be included in the theme as-is.

- **`assets/fonts/`**: Custom font files (`.woff2`, etc.) that are registered via `theme.json`.
- **`assets/js/`**: JavaScript files that are enqueued directly without a build step.

### `includes/` and `functions.php`

This directory contains all the custom PHP functionality for the theme, broken into modular files. This includes helpers, hooks for enqueuing styles and scripts, and custom block registrations.

The `functions.php` file requiere each one in a specific order.

### `style.css`

WordPress requires this file solely for theme registration metadata, such as the theme's name, author, and version.

> [!IMPORTANT]
> This file is for metadata only. **It is _not_ enqueued by the theme. Do _not_ add any CSS here.**

### `theme.json`

This file is primarily used to:

- Define and configure global settings and design tokens (colors, fonts, spacing).
- Register custom templates, template parts, and patterns.

> [!IMPORTANT]
> **It is _not_ used for applying styles.** All theme styles are managed in the `src/css/` directory for a more maintainable and powerful development experience.

### `src/`

The `src/` folder is where most of your project's source code lives. These files are processed, optimized, and bundled by the build system to create the final assets served to the browser.

- **`src/css/`**: All the CSS source files for the theme. They are processed by PostCSS using the `index.css` file and combined into a single `theme.css` file in the `dist/css/` folder.
- **`src/svg/`**: All source SVG files, typically icons. They are automatically optimized by `svgo` and copied to the `dist/svg/` folder during the build process.

### `dist/`

The `dist/` (distribution) directory contains the final, production-ready assets generated by the build process. This is the only directory from which assets are enqueued by the theme.

> [!IMPORTANT]
> This directory is ignored by Git. You should never edit files in this directory directly, as they will be overwritten on the next build.

## CSS Architecture

> [!IMPORTANT]
> This theme uses a **modular CSS architecture** based on the [**CUBE CSS methodology**](https://piccalil.li/blog/cube-css/) and **[this CSS project boilerplate](https://piccalil.li/blog/a-css-project-boilerplate/)**. It requires an automated build process.

### The "Why" behind the build

Maintainable CSS and production performance are prioritized over relying on the cumbersome CSS-in-JSON provided by [Full Site Editing (FSE)](https://fullsiteediting.com/). This requires a **PostCSS build system** because:

| Rationale | Necessity for this theme | PostCSS plugin support |
| :--- | :--- | :--- |
| **Enhanced developer experience (DX) & debugging** | Centralizing styles in modular `/src` files allows developers to use powerful **code editor features** (autocompletion, syntax checking) unavailable in `theme.json`. Additionally, using `theme.css` avoids naming conflicts with the WordPress core-injected `style.css` for clearer debugging. | **`postcss-nesting`**, **`postcss-custom-media`** (Enables modern CSS features for better readability and maintainability). |
| **Enhanced performance** | The theme is designed to load only **one optimized CSS file** (`dist/css/theme.css`), with all the comments removed, which significantly reduces HTTP requests, file size, and improves loading speed. | **`postcss-import`** (Combines all source files into the single output file). **`postcss-discard-comments`** (Strips all developer comments to reduce file size). |

### CSS File Organization

The CSS file organization is based on the [CUBE CSS methodology](https://piccalil.li/blog/cube-css/) and [boilerplate](https://piccalil.li/blog/a-css-project-boilerplate/) previously mentioned.

> [!NOTE]
> We name CUBE 'blocks' as 'components' to avoid confusion with WordPress Blocks. And 'compositions' as 'layouts' for clarity.

```text
/
└── src/
    └── css/
        ├── 01-reset/
        │   └── reset.css
        ├── 02-tokens/
        │   ├── 01-breakpoints.css
        │   ├── 02-primitive.css
        │   ├── 03-semantic.css
        ├── 03-elements/
        │   ├── 01-root/
        │   ├── 02-inline-level/
        │   └── 03-block-level/
        ├── 04-wp-overrides/
        ├── 05-layouts/
        │   ├── {layout_01}.css
        │   ├── {layout_02}.css
        │   └── ...
        ├── 06-components/
        │   ├── {reusable_block}.css
        │   ├── ...
        │   ├── wp-block-{block_slug}.css
        │   ├── ...
        │   ├── {plugin_slug}-{block_slug}.css
        │   └── ...
        ├── 07-parts/
        │   ├── ...
        │   ├── site-footer.css
        │   ├── site-header.css
        │   └── ...
        ├── 08-pages/
        │   ├── page-{slug}.css
        │   └── ...
        ├── 09-utilities/
        │   ├── {utility_class_01}.css
        │   ├── {utility_class_02}.css
        │   └── ...
        ├── editor.css
        └── index.css
```

The primary entry point is **`src/css/index.css`**. It uses `@import` rules (processed by PostCSS) to pull in all stylesheets, which are organized into directories.

> [!IMPORTANT]
> **The specific import order in `src/css/index.css` is critical for correct CSS specificity.**

> [!NOTE]
> All stylesheets are imported in default (alphabetical) order, thanks to the `import-glob` PostCSS plugin. Any new `.css` file added under these directories is automatically included in the build.

#### Directory Purposes

- `01-reset/reset.css` — Project‑agnostic normalization and sensible default element resets (rarely modified).
- `02-tokens/` — Design tokens:
  - `01-breakpoints.css` — Custom media queries defining layout breakpoints.
  - `02-primitive.css` — Primitive/raw values (color, spacing, typography, etc.).
  - `03-semantic.css` — Semantic tokens mapping primitives to meaning.
- `03-elements/` — HTML element styles grouped by cascade sensitivity:
  - `01-root/` — Global root/pseudo contexts (`html`, `body`, `:focus-visible`, etc.).
  - `02-inline-level/` — Inline semantics (`a`, `code`, `mark`, `kbd`, `q`, etc.).
  - `03-block-level/` — Block semantics (`heading`, `blockquote`, `lists`, `table`, `forms`, `details`, media).
- `04-wp-overrides/` — Small stylesheets to override WordPress block editor-generated CSS. One concern per file.
- `05-layouts/` — Predefined, project-agnostic compositional layouts (grid, sidebar, switcher, etc.) providing structural flow (rarely modified).
- `06-components/` — Generic components (card, button, pros, etc.) and WordPress blocks (`wp-block-{slug}.css`).
- `07-parts/` — High-level site regions (header, footer, etc.).
- `08-pages/` — Page or section-specific exceptional styles.
- `09-utilities/` — Single-purpose classes (often one property or tightly related group).
- `editor.css` — WP block editor-only styles.
- `index.css` — Single entry point; imports folders alphabetically via `@import-glob` to produce `dist/css/theme.css`.

### Overrides

The theme uses a small `wp-overrides/` folder for focused stylesheet files that neutralize or adapt WordPress block editor-generated CSS. These files are implementation fixes and are intentionally kept separate from reusable utilities.

- Keep override files small and targeted (one issue per file).
- Name files to clearly indicate the same WP class (for example: `has-global-padding.css`).

### Spacing between blocks (`blockGap`)

This theme re-implements the WordPress's default CSS rules for controlling the spacing between blocks (`blockGap`) for the core 4 layout types (default/flow, constrained, flex, and grid) with a simpler, more modern, and theme-controlled approach.

#### Rationale

WordPress’s default blockGap implementation has several drawbacks:

- **Verbosity, complexity, and inconsistent specificity:** The default rules use multiple selectors (`:first-child`, `:last-child`, `*`) and verbose margin logic. They also have varying specificity, making them hard to override reliably in a theme.

```css
:root :where(.is-layout-flow) > :first-child { margin-block-start: 0; } /* Specificity: (0,2,0) */
:root :where(.is-layout-flow) > :last-child { margin-block-end: 0; } /* Specificity: (0,2,0) */
:root :where(.is-layout-flow) > * { margin-block-start: 1em; margin-block-end: 0; } /* Specificity: (0,1,0) */
:root :where(.is-layout-constrained) > :first-child { margin-block-start: 0; } /* Specificity: (0,2,0) */
:root :where(.is-layout-constrained) > :last-child { margin-block-end: 0; } /* Specificity: (0,2,0) */
:root :where(.is-layout-constrained) > * { margin-block-start: 1em; margin-block-end: 0; } /* Specificity: (0,1,0) */
:root :where(.is-layout-flex) { gap: 1em; } /* Specificity: (0,1,0) */
:root :where(.is-layout-grid) { gap: 1em; } /* Specificity: (0,1,0) */
```

- **Limited control and developer experience:** The standard `blockGap` settings (`null`, `true`, `false`) do not allow a theme to fully replace the CSS engine while keeping the editor’s UI controls active. Re-implementing them with CSS custom properties provides full control, predictability, and enhances developer experience (e.g., code editor autocompletion and the possibility of knowing the defined default `blockGap` value vs not if it's set in the `theme.json`).

#### Solution

1. **Enable Block Spacing UI control.** In `theme.json`, `settings.appearanceTools` is set to `true`, which implicitly enables the Block Spacing UI control in the Site Editor.
2. **Disable default CSS.** In `theme.json`, the value of `styles.spacing.blockGap` is set to an empty string (`""`). This prevents WordPress from outputting its default CSS rules for layout spacing, while the UI control from the previous step remain active.
3. **Re-implement with better CSS.** The theme targets the semantic `.is-layout-*` classes that WordPress still adds to the blocks, and applies spacing using the theme's global `--block-gap` variable, defined as a design token.

This results in full theme control over layout spacing, ensures consistency, and leads to a much cleaner and more readable CSS implementation—all without requiring to manually add classes.

#### Implementation

Since the `blockGap` value in `theme.json` is `""`, the actual value is defined as a global CSS custom property, e.g.:

```css
:root {
    --block-gap: 1em;
}
```

Since the WordPress' default CSS is not loaded, the default block margin of some elements (e.g., `h1-h6`, `p`, etc.) is removed, using a 0-specificity selector (`:where()`).

For the layout spacing implementation, see `src/css/04-wp-overrides/block-spacing.css`.

#### References

- [Block Editor - Layout styles](https://developer.wordpress.org/block-editor/explanations/architecture/styles/#layout-styles)
- [theme.json - Appearance Tools](https://developer.wordpress.org/themes/global-settings-and-styles/settings/appearance-tools/)
- [theme.json - Spacing Settings](https://developer.wordpress.org/themes/global-settings-and-styles/settings/spacing/)
